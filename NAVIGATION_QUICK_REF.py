#!/usr/bin/env python3
"""
å¿«é€Ÿå‚è€ƒï¼šCo-NavGPT å¯¼èˆªæ–¹æ³•é€ŸæŸ¥
======================================

æœ¬æ–‡ä»¶æä¾›äº†å„å¯¼èˆªæ–¹æ³•çš„å¿«é€Ÿè°ƒç”¨ç¤ºä¾‹å’Œæ ¸å¿ƒå‚æ•°

"""

# =============================================================================
# 1. VLM/GPT æ–¹æ³•ï¼ˆæ¨èç”¨äºå¤šæœºåè°ƒï¼‰
# =============================================================================
EXAMPLE_GPT = """
python main.py \\
    --nav_mode gpt \\
    --gpt_type 2 \\
    --num_agents 2 \\
    --num_episodes 10
    
ç¯å¢ƒå˜é‡: export OPENAI_API_KEY="your_key"
æœ€ä½³æ€§èƒ½: gpt_type=2 (gpt-4o)
æˆæœ¬: æ¯ episode çº¦ $0.05-0.20
"""

# =============================================================================
# 2. Greedy æœ€è¿‘é‚»ï¼ˆç®€å•ã€å¿«é€Ÿã€æ— åè°ƒï¼‰
# =============================================================================
EXAMPLE_GREEDY = """
python main.py \\
    --nav_mode nearest \\
    --num_agents 2 \\
    --num_episodes 100
    
ç‰¹ç‚¹: æ¯ä¸ªæœºå™¨äººé€‰è·ç¦»æœ€è¿‘çš„ frontier
ä¼˜ç‚¹: æé€Ÿã€æ— ä»»ä½•ä¾èµ–
ç¼ºç‚¹: æ— å¤šæœºåè°ƒã€æ˜“é‡å¤æ¢ç´¢
"""

# =============================================================================
# 3. Cost-Utilityï¼ˆæˆæœ¬-æ•ˆç”¨å¹³è¡¡ï¼‰
# =============================================================================
EXAMPLE_COST_UTILITY = """
python main.py \\
    --nav_mode co_ut \\
    --num_agents 2 \\
    --num_episodes 10

ç‰¹ç‚¹: ç»¼åˆè€ƒè™‘è·ç¦»æˆæœ¬å’Œæ¢ç´¢æ•ˆç”¨
å…¬å¼: score = utility / (distance + epsilon)
"""

# =============================================================================
# 4. Random Fillï¼ˆç³»ç»Ÿæ€§éšæœºæ¢ç´¢ï¼‰
# =============================================================================
EXAMPLE_RANDOM = """
python main.py \\
    --nav_mode fill \\
    --fill_mode 0 \\
    --num_agents 3 \\
    --num_episodes 5

ç‰¹ç‚¹: åœ¨å·²çŸ¥åœ°å›¾ä¸Šéšæœºé‡‡æ ·
ç”¨é€”: å¿«é€Ÿå¤šè½®æµ‹è¯•ã€baselineå¯¹æ¯”
"""

# =============================================================================
# 5. Multi-SemExpï¼ˆå¤šè¯­ä¹‰èåˆï¼‰
# =============================================================================
EXAMPLE_MULTI_SEM = """
python main.py \\
    --nav_mode gpt \\
    --num_agents 3 \\
    --visualize 1 \\
    --print_images 1

å…³é”®: å¤šæœºå™¨äººç‚¹äº‘èšåˆ + è¯­ä¹‰åˆ†å‰²èåˆ + GPT å†³ç­–
å·¥ä½œæµ:
  1. æ¯ä¸ªæœºå™¨äººæ•è· RGB-D + æ£€æµ‹
  2. èšåˆæ‰€æœ‰ç‚¹äº‘åˆ°å…¨å±€åœ°å›¾
  3. æ£€æµ‹ frontier
  4. GPT æ ¹æ®å¤šè§†è§’ä¿¡æ¯åˆ†é…ç›®æ ‡
"""

# =============================================================================
# 6. æ–¹æ³•è°ƒç”¨çš„æ ¸å¿ƒæµç¨‹
# =============================================================================

"""
ä¸»ç¨‹åºæµç¨‹ (main.py):

æ¯ä¸ªå…¨å±€æ­¥:
  1. æ‰€æœ‰æœºå™¨äººè¿›è¡Œå±€éƒ¨mapping
     - agent[i].mapping(observations[i], agent_state)
     - ç”Ÿæˆå±€éƒ¨ç‚¹äº‘å’Œç‰¹å¾
  
  2. èšåˆæ‰€æœ‰æœºå™¨äººçš„ç‚¹äº‘å’Œåœ°å›¾
     - point_sum += agent[i].point_sum
     - åˆå¹¶åœ°å›¾ç”Ÿæˆå…¨å±€è§†å›¾
  
  3. æ£€æµ‹ frontier (è¾¹ç•Œ)
     - frontier_list = detect_frontier(explored_map, obstacle_map)
  
  4. æ ¹æ® nav_mode é€‰æ‹©å¯¼èˆªç­–ç•¥:
     
     â”Œâ”€ if nav_mode == 'gpt':
     â”‚   â”œâ”€ ç”Ÿæˆå€™é€‰åœ°å›¾å¯è§†åŒ– (get_all_candidate_maps)
     â”‚   â”œâ”€ æ„å»º GPT æç¤ºè¯ (message_prepare)
     â”‚   â”œâ”€ è°ƒç”¨ GPT-4V API (chat_with_gpt4v)
     â”‚   â””â”€ è¿”å›: goal_points[i] = frontier[assigned_idx]
     â”‚
     â”œâ”€ elif nav_mode == 'nearest':
     â”‚   â”œâ”€ å¯¹æ¯ä¸ªæœºå™¨äºº
     â”‚   â””â”€ goal_points[i] = closest_frontier_to(current_pos[i])
     â”‚
     â”œâ”€ elif nav_mode == 'co_ut':
     â”‚   â”œâ”€ å¯¹æ¯ä¸ªæœºå™¨äººè®¡ç®— score = utility / distance
     â”‚   â””â”€ goal_points[i] = frontier_with_max_score
     â”‚
     â””â”€ elif nav_mode == 'fill':
         â””â”€ goal_points[i] = random_point_on_map()
  
  5. æ¯ä¸ªæœºå™¨äººæ ¹æ® goal_points[i] è§„åˆ’è·¯å¾„å¹¶æ‰§è¡Œ
     - agent[i].act(goal_points[i])
"""

# =============================================================================
# 7. GPT å‚æ•°è¯¦è§£
# =============================================================================

GPT_TYPES = {
    0: "text-davinci-003 (å·²å¼ƒç”¨ï¼Œä¸æ¨è)",
    1: "gpt-3.5-turbo (ä¾¿å®œï¼Œå¿«é€Ÿï¼Œä½†æ™ºèƒ½åº¦ä¸€èˆ¬)",
    2: "gpt-4o (æ¨èï¼æœ€æ™ºèƒ½ï¼Œæ€§èƒ½æœ€å¥½)",
    3: "gpt-4o-mini (æŠ˜ä¸­ï¼šæˆæœ¬ä½ã€é€Ÿåº¦å¿«ã€æ™ºèƒ½åº¦ä¸­ç­‰)",
}

# æ€§èƒ½å¯¹æ¯” (cost, speed, intelligence)
PERFORMANCE = """
     cost       speed    intelligence   æ¨èåœºæ™¯
3.5-turbo: $ -------- å¿«é€Ÿ ------- â—‹â—‹â—‹ å¿«é€ŸåŸå‹ã€æˆæœ¬æ•æ„Ÿ
gpt-4o:    $$ -------- ä¸­ç­‰ ------- â—â—â— ç”Ÿäº§ç¯å¢ƒã€å‘è¡¨è®ºæ–‡
4o-mini:   $$ -------- å¿«é€Ÿ ------- â—â—â—‹ éªŒè¯ç®—æ³•ã€æµ‹è¯•
davinci:   $$ -------- æ…¢é€Ÿ ------- â—â—â— å·²å¼ƒç”¨
"""

# =============================================================================
# 8. å®é™…è°ƒç”¨é“¾è·¯
# =============================================================================

CALL_CHAIN = """
main.py:
  â”œâ”€ for each global_step:
  â”‚   â”œâ”€ agent[i].mapping(obs[i], state)
  â”‚   â”œâ”€ point_sum += agent[i].point_sum
  â”‚   â”œâ”€ detect_frontier() â†’ frontier_list
  â”‚   â”‚
  â”‚   â””â”€ if nav_mode == 'gpt':
  â”‚       â”œâ”€ chat_utils.get_all_candidate_maps(frontier_list)
  â”‚       â”œâ”€ chat_utils.message_prepare(...)
  â”‚       â””â”€ chat_utils.chat_with_gpt4v(message)
  â”‚           â†“ (å¼‚æ­¥è°ƒç”¨)
  â”‚       openai.ChatCompletion.create(
  â”‚           model="gpt-4-vision",
  â”‚           messages=[...]
  â”‚       )
  â”‚           â†“ (è¿”å›)
  â”‚       goal_frontiers = {"robot_0": "frontier_3", ...}
  â”‚
  â”‚   â””â”€ agent[i].act(goal_points[i])
  â”‚       â”œâ”€ search_navigable_path(goal_point)
  â”‚       â”œâ”€ plan_path = FMM_Planner.search()
  â”‚       â””â”€ return action

main_vec.py (å¤šè¿›ç¨‹ç‰ˆæœ¬):
  â”œâ”€ ä½¿ç”¨ multiprocessing.Process å¹¶è¡Œè¿è¡Œå¤šä¸ª episode
  â”œâ”€ é€‚åˆå¤§è§„æ¨¡æ•°æ®æ”¶é›†å’Œè¯„ä¼°
  â””â”€ å‚æ•°: --num_processes 4
"""

# =============================================================================
# 9. å¿«é€Ÿå¯¹æ¯”è¡¨
# =============================================================================

COMPARISON_TABLE = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–¹æ³•        â”‚ nav_mode â”‚ å¤šæœºåè°ƒ â”‚ è®¡ç®—æˆæœ¬ â”‚ APIä¾èµ–  â”‚ é€Ÿåº¦     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VLM/GPT     â”‚ gpt      â”‚ âœ… å¼º   â”‚ ğŸ”´ é«˜   â”‚ âŒ éœ€è¦  â”‚ ä¸­ç­‰     â”‚
â”‚ Greedy NN   â”‚ nearest  â”‚ âŒ æ—    â”‚ ğŸŸ¢ æä½  â”‚ âœ… æ—     â”‚ æå¿«     â”‚
â”‚ Cost-Util   â”‚ co_ut    â”‚ âš ï¸  å¯é€‰ â”‚ ğŸŸ¡ ä¸­   â”‚ âœ… æ—     â”‚ å¿«é€Ÿ     â”‚
â”‚ Random Fill â”‚ fill     â”‚ âŒ æ—    â”‚ ğŸŸ¢ æä½  â”‚ âœ… æ—     â”‚ æå¿«     â”‚
â”‚ Multi-Sem   â”‚ (ç»„åˆ)   â”‚ âœ… å¼º   â”‚ ğŸŸ¡ ä¸­   â”‚ âŒ éœ€è¦  â”‚ ä¸­ç­‰-æ…¢  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é€‰æ‹©å»ºè®®:
  - å¿«é€ŸéªŒè¯æƒ³æ³• â†’ nearest (1åˆ†é’Ÿå†…)
  - å‘è¡¨è®ºæ–‡ â†’ gpt (éœ€è¦é«˜è´¨é‡)
  - æˆæœ¬æ•æ„Ÿ â†’ 4o-mini æˆ– nearest
  - å®æ—¶æœºå™¨äºº â†’ nearest æˆ– co_ut
  - ç ”ç©¶å¯¹æ¯” â†’ æ‰€æœ‰æ–¹æ³•éƒ½è·‘ï¼Œå¯¹æ¯”æ€§èƒ½
"""

# =============================================================================
# 10. ç¯å¢ƒé…ç½®é€ŸæŸ¥
# =============================================================================

ENV_SETUP = """
# åŸºç¡€ç¯å¢ƒ
conda create -n co-nav python=3.8
conda activate co-nav
pip install -r requirements.txt

# GPT API é…ç½®
export OPENAI_API_KEY="sk-xxx..."

# å…¶ä»–å¯é€‰
export HABITAT_SCENE_DATASETS=./data/scene_datasets
export HM3D_DATA=./data/scene_datasets/hm3d_v0.2

# éªŒè¯å®‰è£…
python -c "import habitat; print(habitat.__version__)"
python -c "import torch; print(torch.cuda.is_available())"
python -c "import openai; print('OpenAI OK')"
"""

# =============================================================================
# 11. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
# =============================================================================

QUICK_COMMANDS = """
# æœ€å¿«çš„æµ‹è¯• (Greedy, 1 episode, 1 agent)
python main.py --nav_mode nearest --num_agents 1 --num_episodes 1 -v 0

# å¿«é€ŸåŸå‹ (éšæœº, 5 episodes, 2 agents)
python main.py --nav_mode fill --num_agents 2 --num_episodes 5

# æ ‡å‡†è¯„ä¼° (GPT, 10 episodes, 2 agents, å¯è§†åŒ–)
python main.py --nav_mode gpt --gpt_type 2 --num_agents 2 --num_episodes 10 -v 1

# å¤§è§„æ¨¡è¯„ä¼° (å¤šè¿›ç¨‹)
python main_vec.py --nav_mode gpt --gpt_type 2 --num_agents 2 --num_processes 4

# ä¿å­˜è§†é¢‘
python main.py --nav_mode gpt --gpt_type 2 --num_agents 2 \
    --print_images 1 --save_video 1 --video_fps 10

# å¯¹æ¯”æ‰€æœ‰æ–¹æ³•
for mode in nearest fill co_ut gpt; do
  echo "Testing $mode..."
  python main.py --nav_mode $mode --num_agents 2 --num_episodes 3
done
"""

# =============================================================================

if __name__ == "__main__":
    print(__doc__)
    print("\n" + "="*70)
    print("GPT å‚æ•°è¯¦è§£:")
    print("="*70)
    for k, v in GPT_TYPES.items():
        print(f"  {k}: {v}")
    
    print("\n" + "="*70)
    print("å¿«é€Ÿå‘½ä»¤:")
    print("="*70)
    print(QUICK_COMMANDS)
